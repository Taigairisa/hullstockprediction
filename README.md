# プロジェクトの概要
## GPTのリサーチ結果
### Hull Tactical Market Prediction コンペティション調査
#### 1. コンペの目的・概要
「Hull Tactical - Market Prediction」は、機械学習を用いて株式市場の予測可能性に挑戦するコンペティションです。具体的には、S&P 500指数の日次の「超過リターン」を予測し、それに基づいて資金をどれだけS&P 500に投資するか（レバレッジを含めた配分比率）を決定するモデルの開発が求められています。
このモデルは、市場のボラティリティ（変動率）がS&P 500の120%以内というリスク制約を守りつつ、S&P 500を上回るリターン（ベンチマーク超過収益）を達成する投資戦略を実現することを目指します。
この課題設定は、市場は予測不可能とする従来の「効率的市場仮説 (EMH)」への挑戦という背景があります。
多くの投資プロは長期的にS&P 500指数に勝てないと言われますが、本コンペでは機械学習によって市場に埋もれたパターンや非線形なシグナルを発掘し、市場に勝つ戦略を構築できるかを検証する狙いがあります。

#### 2. 使用データの内容
データは日次頻度の日付順時系列データで、公開情報と専有情報を組み合わせた非常にユニークなものとなっています。主な特徴量として、まず一般的な市場データ（例: S&P 500指数の価格推移や出来高などの指標）が含まれています。またそれに加えて、Hull Tactical社が独自に収集・生成したプロプライエタリ（専有）データが提供されており、これは他では得られない特殊なシグナルを含んでいます。
これら独自データには、市場のノイズや投資家の行動バイアスといった要素を捉えた特徴が含まれており、非線形で繰り返し現れるパターンの発見に役立つとされています。
特徴量の構成は複数のカテゴリ（例えばテクニカル指標、出来高関連指標、マクロ経済指標、センチメント指標等）にまたがる「特徴量ファミリー」として整理されているようです（詳細はデータページに記載）。目的変数（ターゲット）は、各取引日の翌日のS&P 500の超過リターンです。
ここで「超過リターン」とは、基準となるリスクフリー利率やベンチマークを上回る収益を指し、平たく言えばS&P 500指数そのものの翌日騰落率（市場平均に対する上振れ分）と考えてよいでしょう。データはCSV形式などの構造化データで提供され、各行が1営業日分のレコードとなっており、カラムに多数の特徴量とターゲット変数が含まれる形です。提供期間は明示されていませんが、長年分の過去の市場データおよび対応する特徴量が含まれており、モデルの学習に十分なボリュームがあります。
#### 3. 評価指標と提出形式
評価指標（スコアリング関数）には、通常のRMSEや精度ではなく、金融の実運用に即した「シャープレシオ」の変形版が採用されています。
シャープレシオ（Sharpe Ratio）はポートフォリオのリスク調整後リターンを測る指標ですが、本コンペではそれを改良した独自指標を用いてモデルのパフォーマンスを評価します。
この評価指標では、モデルが生み出す投資戦略のリスクとリターンのバランスを見るようになっており、具体的には「高いリターンを上げつつリスク（ボラティリティ）を抑えた戦略」に高スコアが与えられます。一方で、**市場（S&P 500）に比べてボラティリティが過大（市場の120%を超える）**であったり、最終的なリターンがS&P 500に劣後するような戦略にはペナルティが科せられ、スコアが低下します。
要するに、ベンチマークを上回る収益をどれだけ効率的（低リスク）に達成したかが評価される指標となっています。 提出形式も通常のコンペとは異なります。未来の市場データを順次予測していくという性質上、あらかじめ全テスト期間の予測結果をCSV提出する方式ではなく、Kaggleが提供する評価用APIを介してモデルをデプロイし、逐次予測を行う形が採られています。
参加者は所定の形式で推論用ノートブックを作成・提出し、コンペ運営側の評価サーバー上でそれが実行される仕組みです。評価サーバーは予測フェーズにおいて日々新たなテストデータ（当日までの市場データ）を投入し、モデルはその翌日の最適なS&P 500投資比率を返します。
モデルが出力すべき値は各取引日におけるS&P 500への資金配分割合で、0から2までの連続値をとります。
0は「その日は一切投資しない（ポジションゼロ）」ことを意味し、2は「手持ち資金の2倍を投資する」ことを意味します（すなわち資金全額に加えて同額を借り入れて運用する 100%レバレッジのフルポジション)。
レバレッジ上限2倍まで認められているため、モデルは市場予測に自信がある場合はフルレバレッジをかけ、不確実な場合は現金ポジション（0に近い値）をとる、といった出力を日々行います。提出ノートブックの雛形は公式のExample Notebookとして提供されており、適切なAPI利用方法や出力フォーマットの例を見ることができます。
以上により、本コンペの提出形式は実際の運用さながらのリアルタイム予測ストリーミングに近く、将来データの盗み見（情報漏洩）を防ぎつつ現実的な戦略性能を競うものとなっています。

# 準備
## 0. uvのインストール
このプロジェクトではuvというpythonライブラリバージョン管理ツールを使う。Rust製で超爆速。[紹介link](https://speakerdeck.com/mickey_kubo/pythonpatukeziguan-li-uv-wan-quan-ru-men)

どこからでも使えるようにグローバルインストールしておく。
`pip install uv`
このプロジェクトのディレクトリに入り、`uv sync`をして仮想環境を整える。


## 1. kaggle CLI / API の準備

- pip install kaggle もしくは、uv add kaggleでkaggle CLIを落とす
- kaggle > settings > API にてkaggle.jsonをローカルに保存
- kaggle CLI の環境をアクティベートし、以下のコマンドでテスト > zipがダウンロードされていたら成功
  ` kaggle competitions download -c hull-tactical-market-prediction`

## 2. jupyter notebookの準備
- VSCodeの拡張機能 Jupyter をインストールする
- 仮想環境を選んで実行